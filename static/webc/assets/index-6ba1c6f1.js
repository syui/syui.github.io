var V=Object.defineProperty;var B=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>(B(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var x=Symbol("Comlink.proxy"),Y=Symbol("Comlink.endpoint"),E=Symbol("Comlink.releaseProxy"),S=Symbol("Comlink.thrown"),j=e=>typeof e=="object"&&e!==null||typeof e=="function",J={canHandle:e=>j(e)&&Boolean(e[x]),serialize(e){const{port1:t,port2:r}=new MessageChannel,s=e[x];return D(e,t,typeof s=="object"?s:void 0),[r,[r]]},deserialize(e){return e.start(),N(e)}},G={canHandle:e=>j(e)&&S in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},W=new Map([["proxy",J],["throw",G]]);function D(e,t=self,r){t.addEventListener("message",function s(n){if(!n||!n.data)return;const{id:i,type:a,path:o}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(p);let c;try{const l=(r==null?void 0:r.spec)==null;let y=e,f=e,m=r==null?void 0:r.spec,C=m;for(const d of o){if(y=f,C=m,l){f=f[d];continue}if(typeof m=="object"&&m.hasOwnProperty(d))f=f[d],m=m[d];else{f=void 0,m=void 0;break}}switch(a){case 0:c=f;break;case 1:{c=!1;const d=(r==null?void 0:r.set)!==!1,g=l||C==="primitive"||m==="primitive";g||(y=void 0),(d||!g)&&(y[o.slice(-1)[0]]=p(n.data.value),c=!0)}break;case 2:l||m==="function"||(f=void 0),c=f.apply(y,u);break;case 3:{l||(f=void 0);const d=new f(...u);c=L(d)}break;case 4:{const{port1:d,port2:g}=new MessageChannel;D(e,g,r),c=k(d,[d])}break;case 5:c=void 0;break}}catch(l){c={value:l,[S]:0}}Promise.resolve(c).catch(l=>({value:l,[S]:0})).then(l=>{const[y,f]=A(l);t.postMessage(Object.assign(Object.assign({},y),{id:i}),f),a===5&&(t.removeEventListener("message",s),U(t))})}),t.start&&t.start()}function K(e){return e.constructor.name==="MessagePort"}function U(e){K(e)&&e.close()}function N(e,t){return P(e,[],t)}function v(e){if(e)throw new Error("Proxy has been released and is not useable")}function P(e,t=[],r=function(){}){let s=!1;const n=new Proxy(r,{get(i,a){if(v(s),a===E)return()=>w(e,{type:5,path:t.map(o=>o.toString())}).then(()=>{U(e),s=!0});if(a==="then"){if(t.length===0)return{then:()=>n};const o=w(e,{type:0,path:t.map(u=>u.toString())}).then(p);return o.then.bind(o)}return P(e,[...t,a])},set(i,a,o){v(s);const[u,c]=A(o);return w(e,{type:1,path:[...t,a].map(l=>l.toString()),value:u},c).then(p)},apply(i,a,o){v(s);const u=t[t.length-1];if(u===Y)return w(e,{type:4}).then(p);if(u==="bind")return P(e,t.slice(0,-1));const[c,l]=I(o);return w(e,{type:2,path:t.map(y=>y.toString()),argumentList:c},l).then(p)},construct(i,a){v(s);const[o,u]=I(a);return w(e,{type:3,path:t.map(c=>c.toString()),argumentList:o},u).then(p)}});return n}function X(e){return Array.prototype.concat.apply([],e)}function I(e){const t=e.map(A);return[t.map(r=>r[0]),X(t.map(r=>r[1]))]}var z=new WeakMap;function k(e,t){return z.set(e,t),e}function L(e,t){return Object.assign(e,{[x]:t??!0})}function A(e){for(const[t,r]of W)if(r.canHandle(e)){const[s,n]=r.serialize(e);return[{type:3,name:t,value:s},n]}return[{type:0,value:e},z.get(e)||[]]}function p(e){switch(e.type){case 3:return W.get(e.name).deserialize(e.value);case 0:return e.value}}function w(e,t,r){return new Promise(s=>{const n=$();e.addEventListener("message",function i(a){!a.data||!a.data.id||a.data.id!==n||(e.removeEventListener("message",i),s(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function $(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function q(e){const t={d:{}};for(const r of Object.keys(e)){const s=e[r];if("file"in s){const i=s.file.contents,a=typeof i=="string"?i:Q(i),o=typeof i=="string"?{}:{b:!0};t.d[r]={f:{c:a,...o}};continue}const n=q(s.directory);t.d[r]=n}return t}function Q(e){let t="";for(const r of e)t+=String.fromCharCode(r);return t}var Z="https://stackblitz.com/headless",_=null,M=!1,F=!1,ee=new TextDecoder,te=new TextEncoder,H=class{constructor(e,t,r){b(this,"fs");this._endpoint=e,this._iframe=r,this.fs=new ae(t)}async spawn(e,t,r){let s=[];Array.isArray(t)?s=t:r=t;let n=new ReadableStream,i;(r==null?void 0:r.output)!==!1&&(n=new ReadableStream({start(u){i=c=>u.enqueue(c)}}));const a=le(ce(i)),o=await this._endpoint.run({command:e,args:s,env:r==null?void 0:r.env,terminal:r==null?void 0:r.terminal},void 0,void 0,a);return new ie(o,n)}on(e,t){let r=!1,s=()=>{};const n=(...i)=>{r||t(...i)};return this._endpoint.on(e,L(n)).then(i=>{s=i,r&&s()}),()=>{r=!0,s()}}mount(e,t){const r=te.encode(JSON.stringify(q(e)));return this._endpoint.loadFiles(k(r,[r.buffer]),{mountPoints:t==null?void 0:t.mountPoint})}teardown(){if(F)throw new Error("WebContainer already torn down");F=!0,this.fs._teardown(),this._endpoint.teardown(),this._endpoint[E](),this._iframe.remove()}static async boot(){for(;_;)await _;if(M)throw new Error("WebContainer already booted");const e=oe();_=e.catch(()=>{});try{const t=await e;return M=!0,t}finally{_=null}}},re=1,ne=2,se=class{constructor(e,t){this.name=e,this._type=t}isFile(){return this._type===re}isDirectory(){return this._type===ne}},ie=class{constructor(e,t){b(this,"input");this._process=e,this.output=t,this.input=new WritableStream({write:r=>{this._process.write(r).catch(()=>{})}})}get exit(){return this._process.onExit}kill(){this._process.kill()}resize(e){this._process.resize(e)}},ae=class{constructor(e){b(this,"_fs");this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async writeFile(e,t,r){if(t instanceof Uint8Array){const s=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=k(new Uint8Array(s),[s])}await this._fs.writeFile(e,t,r)}async readdir(e,t){const r=await this._fs.readdir(e,t);return fe(r)||de(r)?r:r.map(n=>new se(n.name,n["Symbol(type)"]))}async mkdir(e,t){return await this._fs.mkdir(e,t)}_teardown(){this._fs[E]()}};async function oe(){const{iframe:e,endpointPromise:t}=ue(),r=await t,s=await r.build({host:window.location.host,version:"1.0.0"}),n=await s.fs();return r[E](),new H(s,n,e)}function ce(e){if(e!=null)return t=>{t instanceof Uint8Array&&e(ee.decode(t))}}function le(e){if(e!=null)return L(e)}function ue(){const e=document.createElement("iframe");e.style.display="none",e.setAttribute("allow","cross-origin-isolated");const t=R();e.src=R().toString();const{origin:r}=t,s=new Promise(n=>{const i=a=>{if(a.origin!==r)return;const{data:o}=a;if(o.type==="init"){n(N(a.ports[0]));return}if(o.type==="warning"){console[o.level].call(console,o.message);return}};window.addEventListener("message",i)});return document.body.insertBefore(e,null),{iframe:e,endpointPromise:s}}function fe(e){return typeof e[0]=="string"}function de(e){return e[0]instanceof Uint8Array}function R(){return new URL(window.WEBCONTAINER_API_IFRAME_URL??Z)}const T={"index.js":{file:{contents:`
import express from 'express';
const app = express();
const port = 3111;
  
app.get('/', (req, res) => {
    res.send('Welcome to a WebContainers app! ðŸ¥³');
});
  
app.listen(port, () => {
    console.log(\`App is live at http://localhost:\${port}\`);
});`}},"package.json":{file:{contents:`
          {
            "name": "example-app",
            "type": "module",
            "dependencies": {
              "express": "latest",
              "nodemon": "latest"
            },
            "scripts": {
              "start": "nodemon index.js"
            }
          }`}}};let h;window.addEventListener("load",async()=>{if(O.value=T["index.js"].file.contents,O.addEventListener("input",t=>{pe(t.currentTarget.value)}),h=await H.boot(),await h.mount(T),await me()!==0)throw new Error("Installation failed");ye()});async function me(){const e=await h.spawn("npm",["install"]);return e.output.pipeTo(new WritableStream({write(t){console.log(t)}})),e.exit}async function ye(){await h.spawn("npm",["run","start"]),h.on("server-ready",(e,t)=>{we.src=t})}async function pe(e){await h.fs.writeFile("/index.js",e)}document.querySelector("#app").innerHTML=`
  <div class="container">
    <div class="editor">
      <textarea>I am a textarea</textarea>
    </div>
    <div class="preview">
      <iframe src="./loading.html"></iframe>
    </div>
  </div>
`;const we=document.querySelector("iframe"),O=document.querySelector("textarea");
