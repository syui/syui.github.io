<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Stable-Diffusion on syui.github.io</title>
    <link>https://syui.github.io/tags/stable-diffusion/</link>
    <description>Recent content in Stable-Diffusion on syui.github.io</description>
    <generator>Hugo</generator>
    <language>ja-jp</language>
    <copyright>&amp;copy; syui</copyright>
    <lastBuildDate>Tue, 09 Jan 2024 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://syui.github.io/tags/stable-diffusion/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>[stable diffusion] diffusersのscriptを作る</title>
      <link>https://syui.github.io/blog/post/2024/01/09/stable-diffusion/</link>
      <pubDate>Tue, 09 Jan 2024 00:00:00 +0000</pubDate>
      <guid>https://syui.github.io/blog/post/2024/01/09/stable-diffusion/</guid>
      <description>&lt;p&gt;現在はstable diffusionはv2.1が最新らしい。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://huggingface.co/stabilityai/stable-diffusion-2-1&#34;&gt;https://huggingface.co/stabilityai/stable-diffusion-2-1&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://github.com/Stability-AI/stablediffusion&#34;&gt;https://github.com/Stability-AI/stablediffusion&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;今回は、前回同様に&lt;code&gt;txt2img.py&lt;/code&gt;を動かせる環境を構築した上で、&lt;code&gt;.safetensors&lt;/code&gt;を使用し画像生成してみました。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/syui/img/master/other/stable_diffusion_model_anythingv5_20240109_0001.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;txt2imgはcliから使うstable-diffusionのようなものです。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;origin : &lt;a href=&#34;https://github.com/CompVis/stable-diffusion/blob/main/scripts/txt2img.py&#34;&gt;txt2img.py&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;fork : &lt;a href=&#34;https://github.com/basujindal/stable-diffusion/blob/main/optimizedSD/optimized_txt2img.py&#34;&gt;txt2img.py&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://developer.nvidia.com/cuda-toolkit-archive&#34;&gt;cuda&lt;/a&gt;を12.3から12.1にdowngradeします。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://pytorch.org/get-started/locally/&#34;&gt;pytorch&lt;/a&gt;は&lt;code&gt;stable&lt;/code&gt;ではなく&lt;code&gt;nightly&lt;/code&gt;であるpre-versionを使わないとインストールできません。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# pytorch:nightly, cuda:12.1&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ pip install --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu121&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ conda install pytorch&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;2.1.1 torchvision&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;0.16.1 torchaudio&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;2.1.1 pytorch-cuda&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;12.1 -c pytorch -c nvidia&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;scoopの&lt;code&gt;anaconda3&lt;/code&gt;がなくなっていたので手動でインストールしました。具体的には&lt;code&gt;miniconda&lt;/code&gt;を適当にインストールして&lt;code&gt;~/miniconda3/condabin&lt;/code&gt;にpathを通します。私はpwshを使うので、以下のコマンドで自動設定します。これをやらないと&lt;code&gt;activate&lt;/code&gt;を使えません。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ conda init powershell&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;新しいgpuでは5-10分の生成が1-2分以内に変わっていました。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ conda activate ldm&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ cd ./stable-diffusion&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ python ./optimizedSD/optimized_txt2img.py --prompt &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;masterpiece, high quality, very_high_resolution, large_filesize, full color, beautiful kawaii, gold hair, little girl&amp;#34;&lt;/span&gt; --H &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt; --W &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt; --seed $seed --n_iter &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; --n_samples &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; --ddim_steps &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上記のscriptが動くなら&lt;code&gt;.safetensors&lt;/code&gt;を読み込む環境は整っていると思われます。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
